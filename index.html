<!DOCTYPE html>
<html lang="hi">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>दूध की कीमत कैलकुलेटर</title>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Hind:wght@400;600;700&display=swap');

    :root {
        --primary: #1565c0;
        --primary-dark: #0d47a1;
        --secondary: #2e7d32;
        --secondary-light: #e8f5e9;
        --background: #f5f9ff;
        --surface: #ffffff;
        --error: #d32f2f;
        --text-primary: #263238;
        --text-secondary: #546e7a;
        --border: #90caf9;
        --shadow: rgba(0, 0, 0, 0.1);
        --success: #388e3c;
        --warning: #f57c00;
        
        /* Dark mode variables */
        --dark-bg: #1a1a1a;
        --dark-surface: #2d2d2d;
        --dark-text: #e0e0e0;
        --dark-border: #555555;
    }

    /* Dark mode styles */
    body.dark-mode {
        --background: var(--dark-bg);
        --surface: var(--dark-surface);
        --text-primary: var(--dark-text);
        --text-secondary: #aaaaaa;
        --border: var(--dark-border);
        --secondary-light: #2d4d2e;
    }

    * {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
    }

    body {
        font-family: 'Hind', sans-serif;
        background: var(--background);
        margin: 0;
        padding: 10px;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
        color: var(--text-primary);
        line-height: 1.6;
        transition: background-color 0.3s, color 0.3s;
    }

    .container {
        background: var(--surface);
        max-width: 900px;
        width: 100%;
        padding: 20px;
        box-shadow: 0 4px 12px var(--shadow);
        border-radius: 12px;
        margin: 10px 0;
        transition: background-color 0.3s;
        position: relative;
    }

    .app-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 15px;
        flex-wrap: wrap;
        gap: 10px;
        position: relative;
    }

    .app-title-container {
        display: flex;
        align-items: center;
        gap: 10px;
        flex: 1;
    }

    h1 {
        text-align: center;
        color: var(--primary);
        margin-bottom: 15px;
        font-weight: 700;
        font-size: 22px;
        padding-bottom: 10px;
        border-bottom: 2px solid var(--border);
    }

    .app-icon {
        font-size: 28px;
        color: var(--primary);
    }

    .theme-toggle {
        background: var(--primary);
        color: white;
        border: none;
        padding: 8px 12px;
        border-radius: 8px;
        cursor: pointer;
        display: flex;
        align-items: center;
        gap: 8px;
        font-weight: 600;
        transition: background-color 0.3s;
        font-size: 14px;
    }

    .theme-toggle:hover {
        background: var(--primary-dark);
    }

    .form-section {
        margin-bottom: 15px;
        padding: 15px;
        background: #f8fbff;
        border-radius: 8px;
        border-left: 4px solid var(--primary);
        transition: background-color 0.3s;
    }

    body.dark-mode .form-section {
        background: #2a3b4d;
    }

    .section-title {
        font-size: 16px;
        color: var(--primary);
        margin-bottom: 12px;
        font-weight: 700;
        display: flex;
        align-items: center;
    }

    .section-title i {
        margin-right: 8px;
        font-size: 18px;
    }

    label {
        font-weight: 600;
        margin-top: 12px;
        display: block;
        font-size: 15px;
        color: var(--text-primary);
    }

    select, input[type="number"], input[type="date"], input[type="text"] {
        width: 100%;
        padding: 12px;
        margin-top: 6px;
        border-radius: 8px;
        border: 1.5px solid var(--border);
        font-size: 16px;
        transition: all 0.3s ease;
        background: var(--surface);
        color: var(--text-primary);
    }

    select:focus, input[type="number"]:focus, input[type="date"]:focus, input[type="text"]:focus {
        outline: none;
        border-color: var(--primary);
        box-shadow: 0 0 0 3px rgba(21, 101, 192, 0.2);
    }

    button {
        background-color: var(--primary);
        color: white;
        border: none;
        padding: 14px 16px;
        font-size: 16px;
        margin-top: 15px;
        cursor: pointer;
        border-radius: 8px;
        font-weight: 600;
        transition: all 0.3s ease;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        width: 100%;
    }

    button i {
        margin-right: 8px;
    }

    button:hover {
        background-color: var(--primary-dark);
        transform: translateY(-2px);
        box-shadow: 0 4px 8px var(--shadow);
    }

    button.secondary {
        background-color: var(--secondary);
    }

    button.secondary:hover {
        background-color: #1b5e20;
    }

    button.danger {
        background-color: var(--error);
    }

    button.danger:hover {
        background-color: #b71c1c;
    }
    
    button.warning {
        background-color: var(--warning);
    }

    button.warning:hover {
        background-color: #e65100;
    }
    
    button.success {
        background-color: var(--success);
    }

    button.success:hover {
        background-color: #2e7d32;
    }

    .buttons {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-top: 20px;
    }

    .producerBlock {
        background-color: var(--secondary-light);
        border-radius: 8px;
        border: 1px solid #a5d6a7;
        padding: 15px;
        margin-top: 15px;
        position: relative;
        transition: all 0.3s ease;
    }

    .producerBlock:hover {
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.08);
    }

    .producer-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 12px;
    }

    .producer-title {
        color: var(--secondary);
        font-weight: 700;
        font-size: 16px;
        margin: 0;
    }

    .remove-producer {
        background: var(--error);
        color: white;
        border: none;
        width: 30px;
        height: 30px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        font-size: 16px;
        padding: 0;
    }

    .input-row {
        display: flex;
        flex-direction: column;
        gap: 12px;
        margin-bottom: 12px;
    }

    .input-group {
        width: 100%;
    }

    .results-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
        font-size: 14px;
        box-shadow: 0 2px 8px var(--shadow);
        border-radius: 8px;
        overflow: hidden;
    }

    .results-table th, .results-table td {
        padding: 12px 8px;
        border-bottom: 1px solid #e0e0e0;
        text-align: center;
    }

    .results-table th {
        background-color: var(--primary);
        color: white;
        font-weight: 600;
        font-size: 14px;
    }

    .results-table tr:nth-child(even) {
        background-color: #f5f5f5;
    }

    body.dark-mode .results-table tr:nth-child(even) {
        background-color: #3d3d3d;
    }

    .results-table tr:hover {
        background-color: #e3f2fd;
    }

    body.dark-mode .results-table tr:hover {
        background-color: #37474f;
    }

    .resultSummary {
        margin-top: 20px;
        font-weight: 700;
        font-size: 18px;
        color: var(--secondary);
        text-align: center;
        padding: 15px;
        background: #e8f5e9;
        border-radius: 8px;
        line-height: 1.8;
        transition: background-color 0.3s;
    }

    body.dark-mode .resultSummary {
        background: #2d4d2e;
    }

    .summary-card {
        display: flex;
        flex-direction: column;
        background: var(--surface);
        padding: 15px;
        border-radius: 8px;
        box-shadow: 0 4px 8px var(--shadow);
        margin-top: 20px;
        gap: 15px;
        transition: background-color 0.3s;
    }

    .summary-item {
        text-align: center;
        padding: 10px;
        background: #f8fbff;
        border-radius: 8px;
        transition: background-color 0.3s;
    }

    body.dark-mode .summary-item {
        background: #2a3b4d;
    }

    .summary-value {
        font-size: 20px;
        font-weight: 700;
        color: var(--primary);
        margin-bottom: 5px;
    }

    .summary-label {
        font-size: 14px;
        color: var(--text-secondary);
    }

    @media (min-width: 768px) {
        .container {
            padding: 25px;
        }
        
        .input-row {
            flex-direction: row;
        }
        
        .input-group {
            flex: 1;
        }
        
        .buttons {
            flex-direction: row;
        }
        
        button {
            width: auto;
        }
        
        .summary-card {
            flex-direction: row;
        }
        
        .summary-item {
            flex: 1;
        }
        
        h1 {
            font-size: 24px;
        }
    }

    @media (max-width: 768px) {
        .app-header {
            flex-direction: column;
            align-items: flex-start;
        }
        
        .theme-toggle {
            align-self: flex-end;
            margin-top: 10px;
        }
        
        .app-title-container {
            width: 100%;
            justify-content: center;
        }
        
        h1 {
            font-size: 20px;
        }
    }

    .hidden {
        display: none;
    }

    .date-type-selector {
        display: flex;
        gap: 10px;
        margin-top: 8px;
        flex-wrap: wrap;
    }

    .date-type-btn {
        padding: 10px 12px;
        border: 1.5px solid var(--border);
        border-radius: 8px;
        background: var(--surface);
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s ease;
        flex: 1;
        text-align: center;
        min-width: 120px;
        font-size: 14px;
        color: var(--text-primary);
    }

    .date-type-btn.active {
        background: var(--primary);
        color: white;
        border-color: var(--primary);
    }

    .icon {
        margin-right: 6px;
    }
    
    .days-info {
        background-color: #e3f2fd;
        padding: 10px 12px;
        border-radius: 8px;
        margin-top: 8px;
        font-weight: 600;
        color: var(--primary);
        display: flex;
        align-items: center;
        justify-content: space-between;
        font-size: 14px;
        transition: background-color 0.3s;
    }

    body.dark-mode .days-info {
        background-color: #2a3b4d;
    }
    
    .days-count {
        font-size: 16px;
        color: var(--success);
    }
    
    .calendar-container {
        position: relative;
    }
    
    .calendar-container i {
        position: absolute;
        right: 12px;
        top: 42px;
        color: var(--primary);
        font-size: 18px;
    }
    
    .help-text {
        font-size: 13px;
        color: var(--text-secondary);
        margin-top: 4px;
    }
    
    .default-price-section {
        background-color: #fff8e1;
        border-left: 4px solid var(--warning);
        padding: 15px;
        border-radius: 8px;
        margin-bottom: 20px;
        transition: background-color 0.3s;
    }

    body.dark-mode .default-price-section {
        background-color: #4a3c22;
    }
    
    .apply-price-btn {
        background-color: var(--warning);
        margin-top: 12px;
    }
    
    .apply-price-btn:hover {
        background-color: #e65100;
    }
    
    .notification {
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        border-radius: 8px;
        background-color: var(--success);
        color: white;
        box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        z-index: 1000;
        opacity: 0;
        transform: translateY(-20px);
        transition: opacity 0.3s, transform 0.3s;
    }
    
    .notification.show {
        opacity: 1;
        transform: translateY(0);
    }
    
    .share-buttons {
        display: flex;
        flex-direction: column;
        gap: 10px;
        margin-top: 20px;
    }
    
    @media (min-width: 480px) {
        .share-buttons {
            flex-direction: row;
        }
    }
    
    .result-section {
        margin-top: 25px;
        padding: 20px;
        background: #f8fbff;
        border-radius: 10px;
        border-left: 4px solid var(--primary);
        transition: background-color 0.3s;
    }

    body.dark-mode .result-section {
        background: #2a3b4d;
    }
    
    .table-container {
        overflow-x: auto;
        margin: 15px 0;
        border-radius: 8px;
        box-shadow: 0 2px 8px var(--shadow);
    }
    
    .decimal-input {
        position: relative;
    }
    
    .decimal-input input {
        padding-right: 40px;
    }
    
    .decimal-input::after {
        content: ".";
        position: absolute;
        right: 15px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 20px;
        color: #999;
        background: #f0f0f0;
        width: 30px;
        height: 30px;
        display: flex;
        align-items: center;
        justify-content: center;
        border-radius: 50%;
        cursor: pointer;
    }

    .print-button {
        background-color: #6a1b9a;
    }

    .print-button:hover {
        background-color: #4a148c;
    }

    .share-image-button {
        background-color: #00bfa5;
    }

    .share-image-button:hover {
        background-color: #009688;
    }

    .input-hint {
        font-size: 12px;
        color: var(--text-secondary);
        margin-top: 4px;
        font-style: italic;
    }

    .calculation-date {
        text-align: center;
        margin-top: 10px;
        font-size: 14px;
        color: var(--text-secondary);
    }
    
    /* Print styles */
    @media print {
        body * {
            visibility: hidden;
        }
        #result, #result * {
            visibility: visible;
        }
        #result {
            position: absolute;
            left: 0;
            top: 0;
            width: 100%;
            padding: 0;
            margin: 0;
            box-shadow: none;
        }
        .share-buttons, .app-header, .form-section, .default-price-section {
            display: none !important;
        }
    }
    
    .producer-count-container {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 10px;
        background: #e3f2fd;
        padding: 12px;
        border-radius: 8px;
        border: 1px solid var(--border);
        transition: background-color 0.3s;
    }

    body.dark-mode .producer-count-container {
        background: #2a3b4d;
    }
    
    .producer-count-input {
        flex: 1;
    }
    
    .producer-count-label {
        font-weight: 600;
        color: var(--primary);
        white-space: nowrap;
    }
    
    .auto-update-note {
        font-size: 12px;
        color: var(--text-secondary);
        margin-top: 5px;
        font-style: italic;
        text-align: center;
    }
    
    .whatsapp-message-container {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        background: var(--surface);
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        z-index: 1001;
        max-width: 90%;
        max-height: 80%;
        overflow-y: auto;
        display: none;
    }
    
    .whatsapp-message-container.active {
        display: block;
    }
    
    .whatsapp-overlay {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        z-index: 1000;
        display: none;
    }
    
    .whatsapp-overlay.active {
        display: block;
    }
    
    .whatsapp-message {
        white-space: pre-line;
        margin-bottom: 15px;
        font-size: 16px;
        line-height: 1.5;
    }
    
    .whatsapp-buttons {
        display: flex;
        gap: 10px;
        justify-content: flex-end;
        flex-wrap: wrap;
    }
    
    .copy-button {
        background-color: #25D366;
    }
    
    .copy-button:hover {
        background-color: #128C7E;
    }

    /* Custom confirmation dialog */
    .confirmation-dialog {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0,0,0,0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 2000;
        opacity: 0;
        visibility: hidden;
        transition: opacity 0.3s, visibility 0.3s;
    }

    .confirmation-dialog.active {
        opacity: 1;
        visibility: visible;
    }

    .dialog-content {
        background: var(--surface);
        padding: 25px;
        border-radius: 12px;
        box-shadow: 0 5px 20px rgba(0,0,0,0.2);
        max-width: 400px;
        width: 90%;
        text-align: center;
    }

    .dialog-title {
        font-size: 20px;
        margin-bottom: 15px;
        color: var(--text-primary);
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
    }

    .dialog-message {
        margin-bottom: 20px;
        color: var(--text-secondary);
        line-height: 1.5;
    }

    .dialog-buttons {
        display: flex;
        gap: 15px;
        justify-content: center;
    }

    .dialog-button {
        padding: 10px 20px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
        font-weight: 600;
        transition: all 0.3s;
    }

    .dialog-confirm {
        background: var(--error);
        color: white;
    }

    .dialog-confirm:hover {
        background: #b71c1c;
    }

    .dialog-cancel {
        background: #e0e0e0;
        color: #333;
    }

    .dialog-cancel:hover {
        background: #bdbdbd;
    }

    body.dark-mode .dialog-cancel {
        background: #555;
        color: white;
    }

    body.dark-mode .dialog-cancel:hover {
        background: #777;
    }

    .credit {
        text-align: center;
        margin-top: 20px;
        padding: 10px;
        font-size: 14px;
        color: var(--text-secondary);
        border-top: 1px solid var(--border);
    }

    .created-by {
        font-weight: 600;
        color: var(--primary);
    }

    .creator-input {
        border: none !important;
        background: transparent !important;
        text-align: center;
        color: var(--text-secondary);
        font-size: 14px;
        width: 150px;
        padding: 0 !important;
        margin-top: 0 !important;
    }

    @media (max-width: 768px) {
        .whatsapp-buttons {
            flex-direction: column;
        }
        
        .dialog-buttons {
            flex-direction: column;
        }
        
        .app-header {
            flex-direction: column;
        }
        
        .theme-toggle {
            align-self: flex-end;
            margin-top: 10px;
        }
    }
</style>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
</head>
<body>
    <div class="container">
        <div class="app-header">
            <div class="app-title-container">
                <i class="fas fa-cow app-icon"></i>
                <h1>दूध की कीमत कैलकुलेटर</h1>
            </div>
            <button class="theme-toggle" id="themeToggle">
                <i class="fas fa-moon"></i> डार्क मोड
            </button>
        </div>

        <div class="default-price-section">
            <div class="section-title"><i class="fas fa-tag"></i> डिफ़ॉल्ट दूध की कीमत</div>
            
            <div class="input-row">
                <div class="input-group">
                    <label for="defaultPrice">डिफ़ॉल्ट कीमत प्रति लीटर (₹):</label>
                    <input type="number" id="defaultPrice" min="0" step="0.01" placeholder="कीमत प्रति लीटर" inputmode="decimal" />
                    <div class="input-hint">यह कीमत नए उत्पादकों के लिए स्वचालित रूप से लागू होगी</div>
                </div>
            </div>
            
            <button type="button" class="warning apply-price-btn" onclick="applyDefaultPrice()">
                <i class="fas fa-check-circle"></i> सभी उत्पादकों पर लागू करें
            </button>
        </div>

        <div class="form-section">
            <div class="section-title"><i class="fas fa-users"></i> उत्पादक जानकारी</div>
            
            <div class="producer-count-container">
                <span class="producer-count-label">उत्पादकों की संख्या:</span>
                <div class="input-group producer-count-input">
                    <input type="number" id="numProducers" name="numProducers" min="1" value="1" placeholder="उत्पादक की संख्या" onchange="adjustProducerBlocks()" inputmode="numeric" />
                </div>
            </div>
            <div class="auto-update-note">उत्पादक जोड़ने/हटाने पर संख्या स्वचालित रूप से अपडेट होगी</div>

            <div id="producersContainer"></div>

            <div class="buttons">
                <button type="button" onclick="addProducer()"><i class="fas fa-plus"></i> उत्पादक जोड़ें</button>
                <button type="button" class="secondary" onclick="calculatePrices()"><i class="fas fa-calculator"></i> कीमत निकालें</button>
                <button type="button" class="danger" onclick="showResetConfirmation()"><i class="fas fa-redo"></i> रीसेट करें</button>
            </div>
        </div>

        <div id="result" class="hidden"></div>
        
        <div class="credit">
            <span class="created-by">Created by: </span>
            <input type="text" id="creatorName" class="creator-input" placeholder="आपका नाम" />
        </div>
    </div>

    <div id="notification" class="notification"></div>
    
    <div id="whatsappOverlay" class="whatsapp-overlay"></div>
    <div id="whatsappMessageContainer" class="whatsapp-message-container">
        <h3><i class="fab fa-whatsapp"></i> WhatsApp संदेश</h3>
        <div id="whatsappMessage" class="whatsapp-message"></div>
        <div class="whatsapp-buttons">
            <button type="button" class="danger" onclick="closeWhatsAppMessage()"><i class="fas fa-times"></i> बंद करें</button>
            <button type="button" class="copy-button" onclick="copyWhatsAppMessage()"><i class="fas fa-copy"></i> कॉपी करें</button>
            <button type="button" class="success" onclick="openWhatsApp()"><i class="fab fa-whatsapp"></i> WhatsApp खोलें</button>
            <button type="button" class="share-image-button" onclick="shareImageOnWhatsApp()"><i class="fas fa-image"></i> इमेज साझा करें</button>
        </div>
    </div>

    <!-- Custom Confirmation Dialog -->
    <div class="confirmation-dialog" id="confirmationDialog">
        <div class="dialog-content">
            <div class="dialog-title">
                <i class="fas fa-exclamation-triangle"></i>
                <span>क्या आप सुनिश्चित हैं?</span>
            </div>
            <div class="dialog-message">
                क्या आप वाकई फॉर्म रीसेट करना चाहते हैं? सभी डेटा हट जाएगा।
            </div>
            <div class="dialog-buttons">
                <button class="dialog-button dialog-cancel" onclick="hideResetConfirmation()">रद्द करें</button>
                <button class="dialog-button dialog-confirm" onclick="resetForm()">रीसेट करें</button>
            </div>
        </div>
    </div>

<script>
    let producersCount = 0;
    let producerDateTypes = {}; // Store date type for each producer
    let defaultPrice = 0;
    let currentWhatsAppMessage = '';
    let currentResultImage = '';
    let isDarkMode = localStorage.getItem('darkMode') === 'true';

    // Initialize the form
    function init() {
        // Set theme based on saved preference
        if (isDarkMode) {
            enableDarkMode();
        } else {
            disableDarkMode();
        }
        
        addProducer();
        setDefaultDates();
        
        // Load saved data from localStorage if available
        loadData();
        
        // Set min/max years for date inputs
        setupDateInputRestrictions();
        
        // Setup theme toggle event listener
        document.getElementById('themeToggle').addEventListener('click', toggleTheme);
        
        // Load creator name if available
        const savedName = localStorage.getItem('creatorName');
        if (savedName) {
            document.getElementById('creatorName').value = savedName;
        }
        
        // Save creator name on input
        document.getElementById('creatorName').addEventListener('input', function() {
            localStorage.setItem('creatorName', this.value);
        });
    }
    
    // Toggle between dark and light mode
    function toggleTheme() {
        if (isDarkMode) {
            disableDarkMode();
        } else {
            enableDarkMode();
        }
        isDarkMode = !isDarkMode;
        localStorage.setItem('darkMode', isDarkMode);
    }
    
    function enableDarkMode() {
        document.body.classList.add('dark-mode');
        document.getElementById('themeToggle').innerHTML = '<i class="fas fa-sun"></i> लाइट मोड';
    }
    
    function disableDarkMode() {
        document.body.classList.remove('dark-mode');
        document.getElementById('themeToggle').innerHTML = '<i class="fas fa-moon"></i> डार्क मोड';
    }
    
    // Set up date input restrictions to ensure 4-digit years and reasonable date ranges
    function setupDateInputRestrictions() {
        const currentYear = new Date().getFullYear();
        const minDate = `${currentYear - 1}-01-01`;
        const maxDate = `${currentYear + 1}-12-31`;
        
        // This will be applied to each producer's date inputs when created
        window.minDate = minDate;
        window.maxDate = maxDate;
    }

    // Set default dates for all date inputs
    function setDefaultDates() {
        const today = new Date();
        const yesterday = new Date(today);
        yesterday.setDate(yesterday.getDate() - 1);
        
        const formatDate = (date) => {
            return date.toISOString().split('T')[0];
        };
        
        document.getElementById('startDate')?.setAttribute('value', formatDate(yesterday));
        document.getElementById('endDate')?.setAttribute('value', formatDate(today));
    }

    // Add a new producer block
    function addProducer(producerData = null) {
        producersCount++;
        const container = document.getElementById('producersContainer');
        const producerId = producersCount;

        // Initialize date type for this producer
        producerDateTypes[producerId] = producerData?.dateType || 'days';

        // Determine the price value - use producerData price if available, otherwise use defaultPrice
        const priceValue = producerData?.price !== undefined ? producerData.price : (defaultPrice > 0 ? defaultPrice : '');

        const div = document.createElement('div');
        div.className = 'producerBlock';
        div.id = `producer-${producerId}`;

        div.innerHTML = `
            <div class="producer-header">
                <h3 class="producer-title"><i class="fas fa-user icon"></i>उत्पादक #${producerId}</h3>
                <button class="remove-producer" onclick="removeProducer(${producerId})"><i class="fas fa-times"></i></button>
            </div>
            
            <div class="input-row">
                <div class="input-group">
                    <label for="producerName${producerId}">उत्पादक का नाम (वैकल्पिक):</label>
                    <input type="text" id="producerName${producerId}" placeholder="उत्पादक का नाम" value="${producerData?.name || ''}" />
                </div>
            </div>
            
            <div class="input-row">
                <div class="input-group decimal-input">
                    <label for="quantity${producerId}">दूध की मात्रा (लीटर):</label>
                    <input type="text" id="quantity${producerId}" class="quantity" min="0" step="0.01" placeholder="दूध की मात्रा" required 
                           oninput="validateDecimalInput(this)" inputmode="decimal" value="${producerData?.quantity || ''}" />
                </div>
                
                <div class="input-group decimal-input">
                    <label for="price${producerId}">कीमत प्रति लीटर (₹):</label>
                    <input type="text" id="price${producerId}" class="price" min="0" step="0.01" placeholder="दूध की कीमत" value="${priceValue}" required 
                           oninput="validateDecimalInput(this)" inputmode="decimal" />
                </div>
            </div>
            
            <label>समय अवधि चुनें:</label>
            <div class="date-type-selector">
                <div class="date-type-btn ${producerDateTypes[producerId] === 'days' ? 'active' : ''}" id="days-btn-${producerId}" onclick="setDateType(${producerId}, 'days')">
                    <i class="fas fa-calendar-day icon"></i>दिनों का चयन
                </div>
                <div class="date-type-btn ${producerDateTypes[producerId] === 'dateRange' ? 'active' : ''}" id="dateRange-btn-${producerId}" onclick="setDateType(${producerId}, 'dateRange')">
                    <i class="fas fa-calendar-alt icon"></i>तारीख से तारीख
                </div>
            </div>
            
            <div class="input-row ${producerDateTypes[producerId] === 'days' ? '' : 'hidden'}" id="daysInput-${producerId}">
                <div class="input-group">
                    <label for="numDays${producerId}">दिनों की संख्या:</label>
                    <input type="number" id="numDays${producerId}" value="${producerData?.numDays || ''}" min="1" placeholder="दिनों की संख्या" onchange="updateDaysInfo(${producerId})" 
                           oninput="validateNumberInput(this)" inputmode="numeric" />
                </div>
                <div class="days-info" id="daysInfo-${producerId}">
                    <span>चयनित दिन:</span>
                    <span class="days-count" id="daysCount-${producerId}">0 दिन</span>
                </div>
            </div>
            
            <div class="input-row ${producerDateTypes[producerId] === 'dateRange' ? '' : 'hidden'}" id="dateRangeInput-${producerId}">
                <div class="input-group calendar-container">
                    <label for="startDate${producerId}">शुरुआत तारीख:</label>
                    <input type="date" id="startDate${producerId}" onchange="updateDateRangeInfo(${producerId})" 
                           min="${window.minDate}" max="${window.maxDate}" value="${producerData?.startDate || ''}" />
                    <i class="fas fa-calendar"></i>
                </div>
                <div class="input-group calendar-container">
                    <label for="endDate${producerId}">अंतिम तारीख:</label>
                    <input type="date" id="endDate${producerId}" onchange="updateDateRangeInfo(${producerId})" 
                           min="${window.minDate}" max="${window.maxDate}" value="${producerData?.endDate || ''}" />
                    <i class="fas fa-calendar"></i>
                </div>
                <div class="days-info" id="dateRangeInfo-${producerId}">
                    <span>चयनित दिन:</span>
                    <span class="days-count" id="dateRangeDaysCount-${producerId}">0 दिन</span>
                </div>
            </div>
        `;

        container.appendChild(div);
        updateNumProducersInput();
        
        // Set dates if not already set
        if (!producerData) {
            setDefaultDatesForProducer(producerId);
        }
        
        updateDaysInfo(producerId);
        updateDateRangeInfo(producerId);
        
        // Add event listeners for decimal buttons
        setTimeout(() => {
            const quantityInput = document.getElementById(`quantity${producerId}`);
            const priceInput = document.getElementById(`price${producerId}`);
            
            if (quantityInput) {
                quantityInput.parentElement.addEventListener('click', (e) => {
                    if (e.target.classList.contains('decimal-input')) {
                        const input = quantityInput;
                        const value = input.value;
                        if (!value.includes('.')) {
                            input.value = value + '.';
                            input.focus();
                        }
                    }
                });
            }
            
            if (priceInput) {
                priceInput.parentElement.addEventListener('click', (e) => {
                    if (e.target.classList.contains('decimal-input')) {
                        const input = priceInput;
                        const value = input.value;
                        if (!value.includes('.')) {
                            input.value = value + '.';
                            input.focus();
                        }
                    }
                });
            }
        }, 100);
    }
    
    // Validate decimal inputs to prevent invalid values
    function validateDecimalInput(input) {
        // Get the cursor position
        const cursorPosition = input.selectionStart;
        
        // Replace comma with dot
        let value = input.value.replace(/,/g, '.');
        
        // Remove any non-numeric characters except decimal point
        value = value.replace(/[^0-9.]/g, '');
        
        // Ensure only one decimal point
        const parts = value.split('.');
        if (parts.length > 2) {
            value = parts[0] + '.' + parts.slice(1).join('');
        }
        
        // If the value starts with a decimal point, add a zero before it
        if (value.startsWith('.')) {
            value = '0' + value;
        }
        
        // Update the input value
        input.value = value;
        
        // Restore the cursor position
        input.setSelectionRange(cursorPosition, cursorPosition);
    }
    
    // Validate number inputs to prevent non-numeric values
    function validateNumberInput(input) {
        // Remove any non-numeric characters
        input.value = input.value.replace(/[^0-9]/g, '');
    }

    // Apply default price to all producers
    function applyDefaultPrice() {
        const priceInput = document.getElementById('defaultPrice');
        const price = parseFloat(priceInput.value);
        
        if (isNaN(price) || price < 0) {
            showNotification('कृपया वैध कीमत दर्ज करें', 'error');
            return;
        }
        
        defaultPrice = price;
        localStorage.setItem('milkDefaultPrice', price);
        
        // Apply to all existing producers
        const producerBlocks = document.querySelectorAll('.producerBlock');
        producerBlocks.forEach((block, index) => {
            const producerId = index + 1;
            const priceField = document.getElementById(`price${producerId}`);
            if (priceField) {
                priceField.value = price;
            }
        });
        
        showNotification('डिफ़ॉल्ट कीमत सभी उत्पादकों पर लागू की गई');
    }

    // Show notification
    function showNotification(message, type = 'success') {
        const notification = document.getElementById('notification');
        notification.textContent = message;
        notification.style.backgroundColor = type === 'success' ? 'var(--success)' : 'var(--error)';
        notification.classList.add('show');
        
        setTimeout(() => {
            notification.classList.remove('show');
        }, 3000);
    }

    // Set default dates for a producer
    function setDefaultDatesForProducer(producerId) {
        const today = new Date();
        const yesterday = new Date(today);
        yesterday.setDate(yesterday.getDate() - 1);
        
        const formatDate = (date) => {
            return date.toISOString().split('T')[0];
        };
        
        document.getElementById(`startDate${producerId}`).value = formatDate(yesterday);
        document.getElementById(`endDate${producerId}`).value = formatDate(today);
        
        // Update the date range info
        updateDateRangeInfo(producerId);
    }

    // Remove a producer block
    function removeProducer(producerId) {
        const producerBlock = document.getElementById(`producer-${producerId}`);
        if (producerBlock) {
            producerBlock.remove();
            delete producerDateTypes[producerId];
            updateNumProducersInput();
            renumberProducers();
        }
    }

    // Renumber producers after removal - FIXED VERSION
    function renumberProducers() {
        const producerBlocks = document.querySelectorAll('.producerBlock');
        producersCount = producerBlocks.length;
        
        producerBlocks.forEach((block, index) => {
            const newId = index + 1;
            const producerTitle = block.querySelector('.producer-title');
            if (producerTitle) {
                producerTitle.innerHTML = `<i class="fas fa-user icon"></i>उत्पादक #${newId}`;
            }
            
            // Update all IDs and event handlers in the block
            const oldId = block.id.split('-')[1];
            if (oldId != newId) {
                block.id = `producer-${newId}`;
                
                // Update input IDs and event handlers
                const inputs = block.querySelectorAll('input, button, div');
                inputs.forEach(input => {
                    if (input.id) {
                        input.id = input.id.replace(oldId, newId);
                    }
                    if (input.onclick) {
                        const onclickStr = input.onclick.toString();
                        const newOnclickStr = onclickStr.replace(new RegExp(oldId, 'g'), newId);
                        input.onclick = new Function('return ' + newOnclickStr)();
                    }
                    if (input.onchange) {
                        const onchangeStr = input.onchange.toString();
                        const newOnchangeStr = onchangeStr.replace(new RegExp(oldId, 'g'), newId);
                        input.onchange = new Function('return ' + newOnchangeStr)();
                    }
                });
                
                // Update producerDateTypes
                producerDateTypes[newId] = producerDateTypes[oldId];
                delete producerDateTypes[oldId];
            }
        });
    }

    // Set date type for a producer
    function setDateType(producerId, type) {
        producerDateTypes[producerId] = type;
        
        const daysBtn = document.getElementById(`days-btn-${producerId}`);
        const dateRangeBtn = document.getElementById(`dateRange-btn-${producerId}`);
        const daysInput = document.getElementById(`daysInput-${producerId}`);
        const dateRangeInput = document.getElementById(`dateRangeInput-${producerId}`);
        
        if (type === 'days') {
            daysBtn.classList.add('active');
            dateRangeBtn.classList.remove('active');
            daysInput.classList.remove('hidden');
            dateRangeInput.classList.add('hidden');
        } else {
            daysBtn.classList.remove('active');
            dateRangeBtn.classList.add('active');
            daysInput.classList.add('hidden');
            dateRangeInput.classList.remove('hidden');
            // Update the day count for date range when switching to this type
            updateDateRangeInfo(producerId);
        }
    }

    // Update days info for simple days input
    function updateDaysInfo(producerId) {
        const numDays = document.getElementById(`numDays${producerId}`).value;
        const days = parseInt(numDays) || 0;
        const daysCountElement = document.getElementById(`daysCount-${producerId}`);
        
        if (daysCountElement) {
            daysCountElement.textContent = `${days} दिन`;
            daysCountElement.style.color = days > 0 ? "var(--success)" : "var(--error)";
        }
    }

    // Update date range info and calculate days
    function updateDateRangeInfo(producerId) {
        const startDateStr = document.getElementById(`startDate${producerId}`).value;
        const endDateStr = document.getElementById(`endDate${producerId}`).value;
        const daysCountElement = document.getElementById(`dateRangeDaysCount-${producerId}`);
        
        if (startDateStr && endDateStr) {
            const startDate = new Date(startDateStr);
            const endDate = new Date(endDateStr);
            
            if (startDate > endDate) {
                daysCountElement.textContent = "तारीख गलत है";
                daysCountElement.style.color = "var(--error)";
                return;
            }
            
            const timeDiff = endDate - startDate;
            const daysDiff = Math.floor(timeDiff / (1000 * 60 * 60 * 24)) + 1;
            
            daysCountElement.textContent = `${daysDiff} दिन`;
            daysCountElement.style.color = "var(--success)";
        } else {
            daysCountElement.textContent = "तारीख चुनें";
            daysCountElement.style.color = "var(--text-secondary)";
        }
    }

    // Calculate prices for all producers
    function calculatePrices() {
        const producerBlocks = document.querySelectorAll('.producerBlock');
        if (producerBlocks.length === 0) {
            showNotification('कृपया कम से कम एक उत्पादक जोड़ें', 'error');
            return;
        }

        let overallTotal = 0;
        let totalMilk = 0;
        let resultHTML = `
            <div class="result-section">
                <div class="section-title"><i class="fas fa-list-alt"></i> परिणाम सारांश</div>
                <div class="table-container">
                    <table class="results-table">
                        <tr>
                            <th>उत्पादक</th>
                            <th>दूध (लीटर)</th>
                            <th>कीमत/लीटर (₹)</th>
                            <th>अवधि</th>
                            <th>कुल कीमत (₹)</th>
                        </tr>
        `;

        for (let i = 0; i < producerBlocks.length; i++) {
            const producerId = i + 1;
            const producerName = document.getElementById(`producerName${producerId}`)?.value || `उत्पादक #${producerId}`;
            const qty = parseFloat(document.getElementById(`quantity${producerId}`).value);
            const price = parseFloat(document.getElementById(`price${producerId}`).value);

            if (isNaN(qty) || qty < 0 || isNaN(price) || price < 0) {
                showNotification(`${producerName} के लिए वैध मात्रा और कीमत दर्ज करें`, 'error');
                return;
            }

            let totalDays = 0;
            let periodText = '';

            if (producerDateTypes[producerId] === 'days') {
                totalDays = parseInt(document.getElementById(`numDays${producerId}`).value);
                if (isNaN(totalDays) || totalDays < 1) {
                    showNotification(`${producerName} के लिए वैध दिनों की संख्या दर्ज करें`, 'error');
                    return;
                }
                periodText = `${totalDays} दिन`;
            } else {
                const startDateStr = document.getElementById(`startDate${producerId}`).value;
                const endDateStr = document.getElementById(`endDate${producerId}`).value;
                
                if (!startDateStr || !endDateStr) {
                    showNotification(`${producerName} के लिए शुरुआत और अंत की तारीख चुनें`, 'error');
                    return;
                }
                
                const startDate = new Date(startDateStr);
                const endDate = new Date(endDateStr);
                
                if (startDate > endDate) {
                    showNotification(`${producerName} के लिए शुरुआत की तारीख अंत की तारीख से बाद नहीं हो सकती`, 'error');
                    return;
                }
                
                totalDays = Math.floor((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
                periodText = `${formatDate(startDate)} से ${formatDate(endDate)}`;
            }

            const totalPrice = qty * price * totalDays;
            overallTotal += totalPrice;
            totalMilk += qty * totalDays;

            resultHTML += `
                <tr>
                    <td>${producerName}</td>
                    <td>${qty.toFixed(2)}</td>
                    <td>${price.toFixed(2)}</td>
                    <td>${periodText}</td>
                    <td>${totalPrice.toFixed(2)}</td>
                </tr>
            `;
        }

        const creatorName = document.getElementById('creatorName').value || '';

        resultHTML += `
                    </table>
                </div>
                <p class="resultSummary">
                    कुल दूध: ${totalMilk.toFixed(2)} लीटर<br>
                    कुल कीमत: ₹${overallTotal.toFixed(2)}
                </p>
            
                <div class="summary-card">
                    <div class="summary-item">
                        <div class="summary-value">${producerBlocks.length}</div>
                        <div class="summary-label">उत्पादक</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">${totalMilk.toFixed(2)}</div>
                        <div class="summary-label">लिटर दूध</div>
                    </div>
                    <div class="summary-item">
                        <div class="summary-value">₹${overallTotal.toFixed(2)}</div>
                        <div class="summary-label">कुल कीमत</div>
                    </div>
                </div>
                
                <div class="calculation-date">
                    <i class="fas fa-calendar-alt"></i> गणना दिनांक: ${new Date().toLocaleDateString('hi-IN')}
                </div>
            
                <div class="share-buttons">
                    <button class="success" onclick="shareViaWhatsApp()">
                        <i class="fab fa-whatsapp"></i> WhatsApp पर साझा करें
                    </button>
                    <button class="share-image-button" onclick="shareAsImage()">
                        <i class="fas fa-image"></i> इमेज के रूप में साझा करें
                    </button>
                    <button class="print-button" onclick="printResults()">
                        <i class="fas fa-print"></i> प्रिंट करें
                    </button>
                </div>
                ${creatorName ? `<div class="credit" style="margin-top: 15px; border-top: none;">
                    <span class="created-by">Created by: ${creatorName}</span>
                </div>` : ''}
            </div>
        `;

        const resultDiv = document.getElementById('result');
        resultDiv.innerHTML = resultHTML;
        resultDiv.classList.remove('hidden');
        
        // Create image for WhatsApp sharing
        createResultImage();
        
        // Scroll to results
        resultDiv.scrollIntoView({ behavior: 'smooth' });
    }
    
    // Create result image for sharing
    function createResultImage() {
        const resultSection = document.getElementById('result');
        const originalHTML = resultSection.innerHTML;
        
        // Temporarily remove buttons for image
        const shareButtons = resultSection.querySelector('.share-buttons');
        if (shareButtons) {
            shareButtons.style.display = 'none';
        }
        
        // Use html2canvas to capture the result section as an image
        html2canvas(resultSection).then(canvas => {
            // Convert canvas to data URL
            currentResultImage = canvas.toDataURL('image/png');
            
            // Restore the buttons
            if (shareButtons) {
                shareButtons.style.display = 'flex';
            }
        });
    }
    
    // Share results via WhatsApp
    function shareViaWhatsApp() {
        const resultText = generateResultText();
        currentWhatsAppMessage = resultText;
        
        // Show WhatsApp message preview
        document.getElementById('whatsappMessage').textContent = resultText;
        document.getElementById('whatsappOverlay').classList.add('active');
        document.getElementById('whatsappMessageContainer').classList.add('active');
    }
    
    // Open WhatsApp with the message
    function openWhatsApp() {
        const encodedText = encodeURIComponent(currentWhatsAppMessage);
        window.open(`https://wa.me/?text=${encodedText}`, '_blank');
        closeWhatsAppMessage();
    }
    
    // Share image on WhatsApp
    function shareImageOnWhatsApp() {
        if (!currentResultImage) {
            showNotification('पहले कैलकुलेशन करें', 'error');
            return;
        }
        
        // Create a temporary link for the image
        const link = document.createElement('a');
        link.href = currentResultImage;
        link.download = 'दूध_की_कीमत_कैलकुलेशन.png';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showNotification('इमेज डाउनलोड हो गई है, आप इसे WhatsApp पर साझा कर सकते हैं');
        closeWhatsAppMessage();
    }
    
    // Copy WhatsApp message to clipboard
    function copyWhatsAppMessage() {
        // Create a temporary textarea element to hold the text
        const textarea = document.createElement('textarea');
        textarea.value = currentWhatsAppMessage;
        textarea.setAttribute('readonly', '');
        textarea.style.position = 'absolute';
        textarea.style.left = '-9999px';
        document.body.appendChild(textarea);
        
        // Select and copy the text
        textarea.select();
        try {
            const successful = document.execCommand('copy');
            if (successful) {
                showNotification('संदेश क्लिपबोर्ड पर कॉपी किया गया');
            } else {
                showNotification('कॉपी करने में त्रुटि', 'error');
            }
        } catch (err) {
            showNotification('कॉपी करने में त्रुटि', 'error');
            console.error('Could not copy text: ', err);
        }
        
        // Clean up
        document.body.removeChild(textarea);
    }
    
    // Close WhatsApp message preview
    function closeWhatsAppMessage() {
        document.getElementById('whatsappOverlay').classList.remove('active');
        document.getElementById('whatsappMessageContainer').classList.remove('active');
    }
    
    // Generate text version of results for sharing
    function generateResultText() {
        let text = "दूध की कीमत कैलकुलेशन विवरण\n\n";
        
        const producerBlocks = document.querySelectorAll('.producerBlock');
        for (let i = 0; i < producerBlocks.length; i++) {
            const producerId = i + 1;
            const producerName = document.getElementById(`producerName${producerId}`)?.value || `उत्पादक #${producerId}`;
            const qty = parseFloat(document.getElementById(`quantity${producerId}`).value);
            const price = parseFloat(document.getElementById(`price${producerId}`).value);
            
            let totalDays = 0;
            let periodText = '';

            if (producerDateTypes[producerId] === 'days') {
                totalDays = parseInt(document.getElementById(`numDays${producerId}`).value);
                periodText = `${totalDays} दिन`;
            } else {
                const startDateStr = document.getElementById(`startDate${producerId}`).value;
                const endDateStr = document.getElementById(`endDate${producerId}`).value;
                const startDate = new Date(startDateStr);
                const endDate = new Date(endDateStr);
                totalDays = Math.floor((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
                periodText = `${formatDate(startDate)} से ${formatDate(endDate)}`;
            }

            const totalPrice = qty * price * totalDays;
            
            text += `उत्पादक: ${producerName}\n`;
            text += `दूध की मात्रा: ${qty.toFixed(2)} लीटर\n`;
            text += `कीमत प्रति लीटर: ₹${price.toFixed(2)}\n`;
            text += `अवधि: ${periodText}\n`;
            text += `कुल कीमत: ₹${totalPrice.toFixed(2)}\n\n`;
        }
        
        // Add overall summary
        const totalMilk = Array.from(document.querySelectorAll('.quantity')).reduce((sum, input, index) => {
            const producerId = index + 1;
            const qty = parseFloat(input.value);
            let totalDays = 0;

            if (producerDateTypes[producerId] === 'days') {
                totalDays = parseInt(document.getElementById(`numDays${producerId}`).value);
            } else {
                const startDateStr = document.getElementById(`startDate${producerId}`).value;
                const endDateStr = document.getElementById(`endDate${producerId}`).value;
                const startDate = new Date(startDateStr);
                const endDate = new Date(endDateStr);
                totalDays = Math.floor((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
            }
            
            return sum + (qty * totalDays);
        }, 0);
        
        const overallTotal = Array.from(document.querySelectorAll('.price')).reduce((sum, input, index) => {
            const producerId = index + 1;
            const price = parseFloat(input.value);
            const qty = parseFloat(document.getElementById(`quantity${producerId}`).value);
            let totalDays = 0;

            if (producerDateTypes[producerId] === 'days') {
                totalDays = parseInt(document.getElementById(`numDays${producerId}`).value);
            } else {
                const startDateStr = document.getElementById(`startDate${producerId}`).value;
                const endDateStr = document.getElementById(`endDate${producerId}`).value;
                const startDate = new Date(startDateStr);
                const endDate = new Date(endDateStr);
                totalDays = Math.floor((endDate - startDate) / (1000 * 60 * 60 * 24)) + 1;
            }
            
            return sum + (qty * price * totalDays);
        }, 0);
        
        text += `कुल दूध: ${totalMilk.toFixed(2)} लीटर\n`;
        text += `कुल कीमत: ₹${overallTotal.toFixed(2)}\n\n`;
        text += `कैलकुलेशन दिनांक: ${new Date().toLocaleDateString('hi-IN')}`;
        
        // Add creator name only if available
        const creatorName = document.getElementById('creatorName').value;
        if (creatorName) {
            text += `\n\nCreated by: ${creatorName}`;
        }
        
        return text;
    }
    
    // Share results as an image
    function shareAsImage() {
        if (!currentResultImage) {
            showNotification('पहले कैलकुलेशन करें', 'error');
            return;
        }
        
        // Create a temporary link for downloading
        const link = document.createElement('a');
        link.href = currentResultImage;
        link.download = 'दूध_की_कीमत_कैलकुलेशन.png';
        document.body.appendChild(link);
        link.click();
        document.body.removeChild(link);
        
        showNotification('इमेज डाउनलोड हो गई है, आप इसे WhatsApp पर साझा कर सकते हैं');
    }
    
    // Print results
    function printResults() {
        window.print();
    }

    // Format date to DD/MM/YYYY
    function formatDate(date) {
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = date.getFullYear();
        return `${day}/${month}/${year}`;
    }

    // Adjust producer blocks based on input
    function adjustProducerBlocks() {
        const num = parseInt(document.getElementById('numProducers').value);
        if (isNaN(num) || num < 1) {
            showNotification('कृपया वैध संख्या दर्ज करें', 'error');
            return;
        }

        const container = document.getElementById('producersContainer');
        const currentCount = container.children.length;
        
        if (num > currentCount) {
            for (let i = currentCount; i < num; i++) {
                addProducer();
            }
        } else if (num < currentCount) {
            for (let i = currentCount; i > num; i--) {
                removeProducer(i);
            }
        }
    }

    // Update numProducers input
    function updateNumProducersInput() {
        const container = document.getElementById('producersContainer');
        document.getElementById('numProducers').value = container.children.length;
    }

    // Show reset confirmation dialog
    function showResetConfirmation() {
        document.getElementById('confirmationDialog').classList.add('active');
    }

    // Hide reset confirmation dialog
    function hideResetConfirmation() {
        document.getElementById('confirmationDialog').classList.remove('active');
    }

    // Reset the form
    function resetForm() {
        hideResetConfirmation();
        
        const container = document.getElementById('producersContainer');
        container.innerHTML = '';
        producersCount = 0;
        producerDateTypes = {};
        document.getElementById('result').classList.add('hidden');
        document.getElementById('numProducers').value = 1;
        document.getElementById('defaultPrice').value = '';
        defaultPrice = 0;
        currentResultImage = '';
        
        // Clear localStorage
        localStorage.removeItem('milkDefaultPrice');
        localStorage.removeItem('milkCalculatorData');
        
        // Add a fresh producer
        addProducer();
        
        showNotification('फॉर्म सफलतापूर्वक रीसेट किया गया');
    }

    // Load saved data from localStorage
    function loadData() {
        try {
            const savedPrice = localStorage.getItem('milkDefaultPrice');
            if (savedPrice) {
                document.getElementById('defaultPrice').value = savedPrice;
                defaultPrice = parseFloat(savedPrice);
            }
        } catch (error) {
            console.error('Error loading data:', error);
        }
    }

    // Initialize the form when page loads
    window.onload = init;
</script>
<script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
</body>
</html>
